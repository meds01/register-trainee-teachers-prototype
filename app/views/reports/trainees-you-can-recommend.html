{% extends "_templates/_page.html" %}

{% set filteredRecords = data.records | filterRecords(data) %}
{% set traineesThatCanBeRecommended = filteredRecords | filterByReadyToRecommend %}
{% set needAcademicAward = traineesThatCanBeRecommended | filterByAcademicQualificationsApply %}
{% set qualifications = traineesThatCanBeRecommended | getQualifications | orSeparate %}

{% set pageHeading = 'Trainees you can bulk recommend for ' + qualifications %}

{% set backLink = '/reports' %}
{% set backText = "Reports" %}
{% set navActive = 'reports' %}

{# {% set formAction = "./reinstate/confirm" %} #}

{% set academicYear = data.years.currentAcademicYear %}
{% set academicYearShort = data.years.currentAcademicYear | academicYearToYear %}

{% set censusDate = "2022-10-12" %}

{% set filteredRecords = data.records | filterRecords(data) %}
{% set traineesThatCanBeRecommended = filteredRecords | filterByReadyToRecommend %}

{% set traineeCount = traineesThatCanBeRecommended | length %}


{% set hasZeroTraineesToExport = true if traineeCount == 0 %}

{% block content %}
{{super()}}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">
    <form action="" method="post">

      <h1 class="govuk-heading-l">{{pageHeading}}</h1>

      <p class="govuk-body">This export includes the details of {{traineeCount}} {{"trainee" | pluralise(traineeCount)}}. You can use the CSV file to <a href="/bulk-update/recommend/upload">bulk recommend</a> any of those trainees for {{qualifications}}.
      </p>

      <p class="govuk-body">The export includes all trainees who:
      </p>

      <ul class="govuk-list govuk-list--bullet">
        <li>
          have a complete trainee record
        </li>
        <li>
          are studying on a course which ends in the {{ academicYear }} academic year
        </li>
      </ul>

      <p class="govuk-body">If you want to include a trainee who deferred and is now studying, youâ€™ll need to reinstate them. They will then have the correct course end date.
      </p>

      <input name="successFlash" type="hidden" value="Export successfully downloaded">

      {% if hasZeroTraineesToExport %}
        {{ govukInsetText({
          text: "You have no trainees available to export. Check you have registered new trainees for the " + data.years.currentAcademicYear + " academic year."
        }) }}
      {% endif %}

      {% set buttonText -%}
        Export trainee data ({{traineeCount}} {{"trainee" | pluralise(traineeCount)}})
      {%- endset %}

      {% set downloadFilename = (data.signedInProviders + "-trainees to recommend prepopulated") | slugify %}


      {{ govukButton({
        "text": buttonText,
        href: "/public/downloads/bulk-update/recommendOnly.csv",
        attributes: {
          download: downloadFilename
        }
      }) }}

{#       {{ appDownloadLink({
          linkText: "Download a prepopulated file to recommend trainees for " + qualifications,
          fileName: "bulk-update/recommendOnly" if bulkRecommendOnly else "recommend",
          showDownloadedFileName: true,
          downloadedFileName: (data.signedInProviders + "-trainees to recommend prepopulated") | slugify,
          fileType: "csv"
        })}}
 #}


    </form>
  </div>
</div>

{% endblock %}
